LavaPack.loadBundle([[292,{"../../development/wdyr":295,"../../shared/constants/app":4977,"../../shared/lib/error-utils":5011,"../../shared/lib/trace":5020,"../../shared/lib/ui-utils":5022,"../../shared/modules/browser-runtime.utils":5026,"../../shared/modules/mv3.utils":5039,"../../ui":6103,"./lib/metaRPCClientFactory":83,"./lib/setup-initial-state-hooks":113,"./lib/stream-utils":123,"./lib/util":134,"./platforms/extension":288,"@metamask/eth-query":1534,"@metamask/ethjs":1686,"extension-port-stream":3681,loglevel:4117,"react-devtools":3387,"web3-stream-provider":4937,"webextension-polyfill":4954},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){e("./lib/setup-initial-state-hooks"),e("../../development/wdyr"),e("react-devtools");var r=T(e("extension-port-stream")),a=T(e("webextension-polyfill")),o=T(e("@metamask/ethjs")),i=T(e("@metamask/eth-query")),s=T(e("web3-stream-provider")),l=T(e("loglevel")),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=y(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&{}.hasOwnProperty.call(e,o)){var i=a?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(e("../../ui")),u=e("../../shared/constants/app"),d=e("../../shared/modules/mv3.utils"),m=e("../../shared/modules/browser-runtime.utils"),f=e("../../shared/lib/ui-utils"),p=e("../../shared/lib/error-utils"),g=e("../../shared/lib/trace"),w=T(e("./platforms/extension")),h=e("./lib/stream-utils"),b=e("./lib/util"),v=T(e("./lib/metaRPCClientFactory"));function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(y=function(e){return e?n:t})(e)}function T(e){return e&&e.__esModule?e:{default:e}}const k=1e3,P="phishing-warning-sw-registered",L=document.getElementById("app-content");let E,M=!1;class O extends Error{constructor(){super("Timeout failed")}}function x(e){const t=(0,h.setupMultiplex)(e),n=function(e){return(0,v.default)(e)}(t.createStream("controller"));return function(e){const t=new s.default;t.pipe(e).pipe(t),e.on("error",console.error.bind(console)),t.on("error",console.error.bind(console)),global.ethereumProvider=t,global.ethQuery=new i.default(t),global.eth=new o.default(t)}(t.createStream("provider")),n}(async function(){const e=performance.now(),t=(0,g.trace)({name:g.TraceName.UIStartup,startTime:performance.timeOrigin});(0,g.trace)({name:g.TraceName.LoadScripts,startTime:performance.timeOrigin,parentContext:t}),(0,g.endTrace)({name:g.TraceName.LoadScripts,timestamp:performance.timeOrigin+e}),global.platform=new w.default;const n=(0,b.getEnvironmentType)();E=a.default.runtime.connect({name:n});let o=new r.default(E);const i=await async function(e){0;if(e!==u.ENVIRONMENT_TYPE_POPUP)return{};const t=await a.default.tabs.query({active:!0,currentWindow:!0}).catch((e=>{(0,m.checkForLastErrorAndLog)()||l.default.error(e)})),[n]=t,{id:r,title:o,url:i}=n,{origin:s,protocol:c}=i?new URL(i):{};if(!s||"null"===s)return{};return{id:r,title:o,origin:s,protocol:c,url:i}}(n),s=async e=>{var r;"startUISync"===(null==e||null===(r=e.data)||void 0===r?void 0:r.method)&&((0,g.endTrace)({name:g.TraceName.BackgroundConnect}),d.isManifestV3&&M?function(e){const t=x(e);(0,c.updateBackgroundConnection)(t)}(o):await async function(e,t,n,r){try{const a=await async function(e,t,n){const r=x(t);return await(0,c.default)({activeTab:e,container:L,backgroundConnection:r,traceContext:n})}(e,t,r);(0,g.endTrace)({name:g.TraceName.UIStartup}),M=!0;const o=a.getState(),{metamask:{completedOnboarding:i}={}}=o;i||n===u.ENVIRONMENT_TYPE_FULLSCREEN||global.platform.openExtensionInBrowser()}catch(e){!async function(e,t,n){const r=await(0,p.getErrorHtml)(e,f.SUPPORT_LINK,n);L.innerHTML=r;const o=document.getElementById("critical-error-button");throw null==o||o.addEventListener("click",(e=>{a.default.runtime.reload()})),l.default.error(t.stack),t}("troubleStarting",e)}}(i,o,n,t),d.isManifestV3?await async function(){if((await a.default.storage.session.get(P))[P])return;const e=(0,b.getPlatform)();let t;try{const n=new URL("https://metamask.github.io/phishing-warning/v4.1.0/");let r,o;n.hash="#extensionStartup",t=window.document.createElement("iframe"),t.setAttribute("src",n.href),t.setAttribute("sandbox","allow-scripts allow-same-origin");const i=new Promise(((e,t)=>{r=e,o=t}));t.addEventListener("load",r),window.document.body.appendChild(t),setTimeout((()=>o(new O)),k),await i,e===u.PLATFORM_FIREFOX?console.error("Firefox does not support required MV3 APIs: Phishing warning page iframe and service worker will reload each page refresh"):a.default.storage.session.set({[P]:!0})}catch(e){e instanceof O?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{t&&t.remove()}}():E.onMessage.removeListener(s))};if(d.isManifestV3){const e=()=>{E.onMessage.removeListener(s),E.onDisconnect.removeListener(e),E=a.default.runtime.connect({name:n}),o=new r.default(E),E.onMessage.addListener(s),E.onDisconnect.addListener(e)};E.onDisconnect.addListener(e)}(0,g.trace)({name:g.TraceName.BackgroundConnect,parentContext:t}),E.onMessage.addListener(s)})().catch(l.default.error)}}},{package:"$root$",file:"app/scripts/ui.js"}]],[292],{});